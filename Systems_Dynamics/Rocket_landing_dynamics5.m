function [f,fx,fu,x,u] = Rocket_landing_dynamics5(dt,der_Iiv_bool)
    nx = 19;
    nu = 3;
    x = sym('x',[nx 1]);
    u = sym('u',[nu 1]);
     
    e_1 = [1;0;0];
    g0 = 9.81;      % Ear_Ith standar_Id gr_Iavity
    m = 2;       % vacuum-specific-impulse
% Dynamics:    
    r_I=x(1:3);
    v_I=x(4:6);
    q_BI=x(7:10);
    w_B=x(11:13);
    
    Omega_w_B = [0      -w_B(1)     -w_B(2)     -w_B(3);
                 w_B(1)    0         w_B(3)     -w_B(2);
                 w_B(2) -w_B(3)       0          w_B(1);
                 w_B(3) w_B(2)      -w_B(1)         0  ];
    r_TB=[-1e-2;0;0];
    r_I_cross = [0 -r_TB(3) r_TB(2);r_TB(3) 0 -r_TB(1);-r_TB(2) r_TB(1) 0];
    w_B_cross = [0 -w_B(3) w_B(2);w_B(3) 0 -w_B(1);-w_B(2) w_B(1) 0]; 
    g_I = - e_1; % Gravity vector expressed in FI
    T_B= [x(14);x(15);x(16)];
    q0=q_BI(1); q1=q_BI(2); q2=q_BI(3); q3=q_BI(4); 
    C_IB = [1-2*(q2^2+q3^2), 2*(q1*q2+q0*q3), 2*(q1*q3-q0*q2);
            2*(q1*q2-q0*q3), 1-2*(q1^2+q3^2), 2*(q2*q3+q0*q1);
            2*(q1*q3+q0*q2), 2*(q2*q3-q0*q1), 1-2*(q1^2+q2^2)];
        
    F_I = C_IB * T_B;
    J_B =  1e-2 * eye(3);
    J_B_inv=inv(J_B);
    r_I_I_dot = v_I; % position - x(1):x(3)
    v_I_dot = 1/m * F_I + g_I; % velocity - x(4):x(6)
    q_BI_dot = 1/2 * Omega_w_B * q_BI; %  - x(7):x(10)
    w_B_dot = inv(J_B) * (r_I_cross*T_B - w_B_cross*J_B * w_B); %  - x(11):x(13)
 
    
    f_cont_sym = @(x,u) [       x(4);
                                x(5);
                                x(6);
                                1/m * F_I + g_I;
                                1/2 * Omega_w_B * x(8:11);
                                J_B_inv*(r_I_cross*T_B - w_B_cross*J_B * w_B);
                                x(17);
                                x(18);
                                x(19);
                                u(1);
                                u(2);
                                u(3)];
    

    f = @(x,u) x(1:nx) + dt * [ x(4);
                                x(5);
                                x(6);
                                g_I + 1/m * [1-2*(x(9)^2+x(10)^2), 2*(x(8)*x(9)+x(7)*x(10)), 2*(x(8)*x(10)-x(7)*x(9));
                                          2*(x(8)*x(9)-x(7)*x(10)), 1-2*(x(8)^2+x(10)^2), 2*(x(9)*x(10)+x(7)*x(8));
                                          2*(x(8)*x(10)+x(7)*x(9)), 2*(x(9)*x(10)-x(7)*x(8)), 1-2*(x(8)^2+x(9)^2)] * [u(1);u(2);u(3)];
                                1/2 * ([0       -x(11)     -x(12)     -x(13);
                                       x(11)    0          x(13)     -x(12);
                                       x(12)   -x(13)       0         x(11);
                                       x(13)   x(12)      -x(11)         0]) * x(8:11);
                                J_B_inv*([0 -r_TB(3) r_TB(2);r_TB(3) 0 -r_TB(1);-r_TB(2) r_TB(1) 0]*[x(14);x(15);x(16)] - [0 -x(13) x(12);x(13) 0 -x(11);-x(12) x(11) 0]* J_B * x(12:14))
                                x(17);
                                x(18);
                                x(19);
                                u(1);
                                u(2);
                                u(3)];
                                                                    
    if der_Iiv_bool
        fx = @(x,u) eye(nx)+dt*[0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
            0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
            0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
            0, 0, 0, 0, 0, 0, -(2*x(9)*x(16) - 2*x(10)*x(15))/m,            (2*x(9)*x(15) + 2*x(10)*x(16))/m, -(2*x(7)*x(16) - 2*x(8)*x(15) + 4*x(9)*x(14))/m,   (2*x(7)*x(15) + 2*x(8)*x(16) - 4*x(10)*x(14))/m, 0, 0, 0, -(2*x(9)^2 + 2*x(10)^2 - 1)/m, (2*x(7)*x(10) + 2*x(8)*x(9))/m, -(2*x(7)*x(9) - 2*x(8)*x(10))/m, 0, 0, 0;
            0, 0, 0, 0, 0, 0,   (2*x(8)*x(16) - 2*x(10)*x(14))/m,  (2*x(7)*x(16) - 4*x(8)*x(15) + 2*x(9)*x(14))/m,             (2*x(8)*x(14) + 2*x(10)*x(16))/m, -(2*x(7)*x(14) - 2*x(9)*x(16) + 4*x(10)*x(15))/m, 0, 0, 0, -(2*x(7)*x(10) - 2*x(8)*x(9))/m, -(2*x(8)^2 + 2*x(10)^2 - 1)/m, (2*x(7)*x(8) + 2*x(9)*x(10))/m, 0, 0, 0;
            0, 0, 0, 0, 0, 0,  -(2*x(8)*x(15) - 2*x(9)*x(14))/m, -(2*x(7)*x(15) + 4*x(8)*x(16) - 2*x(10)*x(14))/m, (2*x(7)*x(14) - 4*x(9)*x(16) + 2*x(10)*x(15))/m,              (2*x(8)*x(14) + 2*x(9)*x(15))/m, 0, 0, 0, (2*x(7)*x(9) + 2*x(8)*x(10))/m, -(2*x(7)*x(8) - 2*x(9)*x(10))/m, -(2*x(8)^2 + 2*x(9)^2 - 1)/m, 0, 0, 0;
            0, 0, 0, 0, 0, 0, 0, -x(11)/2, -x(12)/2, -x(13)/2,  -x(8)/2, -x(9)/2, -x(10)/2, 0, 0, 0, 0, 0, 0;
            0, 0, 0, 0, 0, 0, x(11)/2, 0, x(13)/2, -x(12)/2,   x(7)/2, -x(10)/2,  x(9)/2, 0, 0, 0, 0, 0, 0;
            0, 0, 0, 0, 0, 0, x(12)/2, -x(13)/2, 0, x(11)/2,  x(10)/2,   x(7)/2,  -x(8)/2, 0, 0, 0, 0, 0, 0;
            0, 0, 0, 0, 0, 0, x(13)/2, x(12)/2, -x(11)/2, 0, -x(9)/2,   x(8)/2,   x(7)/2, 0, 0, 0, 0, 0, 0;
            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0;
            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,-1, 0, 0, 0, 0;
            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0;
            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0;
            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1;
            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;
            0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
        fu = @(x,u) [0,    0,    0;
                     0,    0,    0;
                     0,    0,    0;
                     0,    0,    0;
                     0,    0,    0;
                     0,    0,    0;
                     0,    0,    0;
                     0,    0,    0;
                     0,    0,    0;
                     0,    0,    0;
                     0,    0,    0;
                     0,    0,    0;
                     0,    0,    0;
                     0,    0,    0;
                     0,    0,    0;
                     0,    0,    0;
                     1,    0,    0;
                     0,    1,    0;
                     0,    0,    1];
    else
        [fx, fu]=deal([]);
    end
end

 

 
